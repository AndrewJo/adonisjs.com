<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_why_are_exceptions_important">Why Are Exceptions Important?</a></li>
<li><a href="#_error_codes">Error Codes</a></li>
<li><a href="#_throwing_exceptions">Throwing Exceptions</a></li>
<li><a href="#_catching_exception">Catching Exception</a></li>
</ul>
</div>
<div class="paragraph">
<p>AdonisJs takes an additional step towards handling and throwing exceptions by making sure exceptions thrown by the core of the framework are more descriptive and helpful for debugging. Also, it offers additional tools &amp; practices to structure well-designed exception messages.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_are_exceptions_important"><a class="anchor" href="#_why_are_exceptions_important"></a><a class="link" href="#_why_are_exceptions_important">Why Are Exceptions Important?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exceptions do not get the care they deserve. The majority of programmers thinks of exceptions a way of terminating the process as something bad happened. Even worse exception messages do not share much context on how to fix the problem and leaves it to the end-user to figure out the cause.</p>
</div>
<div class="paragraph">
<p>With AdonisJs we tag all exceptions with a unique <strong>Error code</strong> and you can refer the documentation of the given error code to understand the cause of the exception.</p>
</div>
<div class="paragraph">
<p>Not only that, but we also offer you a nice npm package called <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noopener">node-exceptions</a> to setup application specific exception classes to throw personal and meaningful exceptions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_codes"><a class="anchor" href="#_error_codes"></a><a class="link" href="#_error_codes">Error Codes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below is the list of error codes thrown by the core of AdonisJs. You can reference them to understand the context of the exception.</p>
</div>
<div class="paragraph">
<p>All exceptions are divided into multiple categories like <strong>General</strong>, <strong>Database</strong>, <strong>Redis</strong>, etc.</p>
</div>
<div class="sect2">
<h3 id="_general"><a class="anchor" href="#_general"></a><a class="link" href="#_general">General</a></h3>
<div class="paragraph">
<p>General exceptions are raised from any part of the framework.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_APPKEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">App key is used to encrypted cookies or any other sensitive value. This exception is raised when <code>appKey</code> is not defined inside <code>config/app.js</code> file which refers to a value inside <code>.env</code> file.</p>
<p class="tableblock">You can make use of an ace command to generate the app key for you. <code>./ace key:generate</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MALFORMED_JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when a function is expecting the parameter to be a valid <code>JSON</code> string but unable to call <code>JSON.parse</code> method on it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_PARAMETER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The most often raised exception when a parameter expected by a method is not being passed or is <code>undefined</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_PARAMETER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when the parameter value is not of correct type. For example, A method expects <code>age</code> to be <strong>Number</strong> but instead a <strong>String</strong> with passed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_CONFIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When configuration for a given key is missing. The exception is raised by <strong>Service providers</strong> when they are trying to access configuration and unable to find it inside the <code>config</code> directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_UNDEFINED_METHOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when a client is trying to access a non-existing method.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_encryption_provider"><a class="anchor" href="#_encryption_provider"></a><a class="link" href="#_encryption_provider">Encryption Provider</a></h3>
<div class="paragraph">
<p>Below is the list of exceptions only raised by the <a href="encryption-and-hashing">Encryption provider</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_ENCRPYTION_CIPHER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when a unsupported cipher is used to encrypt/decrypt a value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_ENCRYPTION_PAYLOAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when the payload passed to the <code>encrypt</code> method is not readable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_ENCRYPTION_MAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when an unsupported encryption mac is defined to encrypt/decrypt a value.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_form_builder_route_provider"><a class="anchor" href="#_form_builder_route_provider"></a><a class="link" href="#_form_builder_route_provider">Form Builder &amp; Route Provider</a></h3>
<div class="paragraph">
<p>Below is the list of all the exceptions only raised by the <a href="form-builder">Form builder</a> or the <a href="routing">Route provider</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_ROUTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to reference a non-existing <strong>Route</strong> inside your views. The most common place is inside the builder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_ROUTE_ACTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception is raised by the <a href="form-builder">Form builder</a> when an unregistered controller/route action is passed to the <code>open</code> method.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_event_provider"><a class="anchor" href="#_event_provider"></a><a class="link" href="#_event_provider">Event Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_NAMED_EVENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="events">Event</a> provider will raise this exception when you are trying to remove an unregistered named listener.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_session_provider"><a class="anchor" href="#_session_provider"></a><a class="link" href="#_session_provider">Session Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_SESSION_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception is raised when the session driver defined inside the <code>config/session.js</code> file does not exists.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_middleware_provider"><a class="anchor" href="#_middleware_provider"></a><a class="link" href="#_middleware_provider">Middleware Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_NAMED_MIDDLEWARE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when an unregistered named middleware is referenced on the routes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_database_provider"><a class="anchor" href="#_database_provider"></a><a class="link" href="#_database_provider">Database Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_MODEL_FACTORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you try to access an unregistered model factory. Make sure to define model factories/blueprints inside <code>database/factory.js</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_DATABASE_FACTORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you try to access an unregistered database factory. Make sure to define model factories/blueprints inside <code>database/factory.js</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_DATABASE_ROW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised by Lucid model methods like <strong>findOrFail</strong> and <strong>findByOrFail</strong> when unable to find a record with the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_MODEL_STATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to save an empty model or trying to update a delete model instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_UNSAVED_MODEL_INSTANCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to save a relationship on a model which itself is unsaved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_RELATION_INSTANCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you pass an invalid model instance to the relationship <code>save</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_RELATION_METHOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you call an <strong>undefined</strong> method on a relationship instance. For example <strong>HasOne</strong> relationship does not have a <code>paginate</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_DATABASE_RELATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to access a relationship which was never defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_LOCK_ON_MIGRATIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are parallelly trying to execute migrations more than once.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_SCHEMA_FILE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when the <strong>schema</strong> files inside <code>database/migrations</code> folder are not exporting an <strong>ES2015</strong> class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_UNSAFE_ENVIRONMENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to execute unsafe operations in the production environment. For example: Running migrations in production.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_MODEL_TRAIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when a model trait does not have a <code>register</code> method on it.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_mail_provider"><a class="anchor" href="#_mail_provider"></a><a class="link" href="#_mail_provider">Mail Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_MAIL_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to access an unregistered mail driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_MAIL_VIEW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to call the <code>Mail.send</code> method without a valid view.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ioc_container"><a class="anchor" href="#_ioc_container"></a><a class="link" href="#_ioc_container">IoC Container</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_IOC_MANAGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when you are trying to register a manager to the IoC container without the <code>extend</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_MAKE_STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when a string passed to <code>Ioc.makeFunc</code> is incorrect. Strings needs to have <strong>dot(.)</strong> seperated class and function name. For example: <code>Ioc.makeFunc('UserController.store')</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_antl_provider"><a class="anchor" href="#_antl_provider"></a><a class="link" href="#_antl_provider">Antl Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_ANTL_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception is raised when the antl driver defined inside the <code>config/antl.js</code> file does not exists.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ally_social_authentication_provider"><a class="anchor" href="#_ally_social_authentication_provider"></a><a class="link" href="#_ally_social_authentication_provider">Ally (Social Authentication) Provider</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OAUTH_TOKEN_EXCHANGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when unable to exchange access token using oauth code. This generally happens within the callback when using <a href="social-auth#_getuser">getUser</a> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_INVALID_ALLY_DRIVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when ally driver defined inside <code>config/services.js</code> file does not exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MISSING_OAUTH_CONFIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is raised when ally configuration does not exists for a given driver.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_throwing_exceptions"><a class="anchor" href="#_throwing_exceptions"></a><a class="link" href="#_throwing_exceptions">Throwing Exceptions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is recommended to throw a contextual exception since it makes it easier for the end user to act upon them. AdonisJs makes use of <a href="https://npmjs.org/package/node-exceptions" target="_blank" rel="noopener">node-exception</a> an npm module to structure exceptions. You can learn more about it via its documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_catching_exception"><a class="anchor" href="#_catching_exception"></a><a class="link" href="#_catching_exception">Catching Exception</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exceptions can be caught by wrapping your code inside a <code>try/catch</code> block, or you can handle them globally by listening to the <code>error</code> event.</p>
</div>
<div class="listingblock">
<div class="title">app/Listeners/Http.js</div>
<div class="content">
<pre class="highlight line-numbers"><code class="language-javascript" data-lang="javascript">Http.handleError = function * (error, request, response) {
  if (error.name === 'ModelNotFoundException') { <i class="conum" data-value="1"></i><b>(1)</b>
    yield response.status(404).sendView('404')
    return
  }

  if (error.name === 'PasswordMisMatch') { <i class="conum" data-value="2"></i><b>(2)</b>
    response.status(400).send('Invalid credentials')
    return
  }

  response.status(error.status).send(error.message) <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the help of custom exceptions, it is so easy to catch them with their <strong>name</strong> and return a personalized response for each exception type.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Handling <strong>ModelNotFoundException</strong> exception thrown by Lucid model <code>findOrFail</code> method and returning a <strong>404</strong> view.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Handling <strong>PasswordMisMatch</strong> exception thrown by <a href="authentication#_attempt_uid_password">authentication provider</a> and return a <strong>400</strong> status.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Generic exception handling for all other exceptions.</td>
</tr>
</table>
</div>
</div>
</div>